---
import BlogLayout from '@layouts/blog.astro';
import { getCollection, getEntry } from 'astro:content';

import { loadImage } from '@utils/ImageDynamic';

export async function getStaticPaths() {
  const allBlogs = await getCollection("blogs");

  return allBlogs.map( blog  => ({
    params: { slug: blog.slug },
    props: { blog }
  }))
}
const { blog } = Astro.props;
const { Content } = await blog.render()

const {
  title = '',
  seoImage = '',
  seoDescription = '',
  author = { slug: '' },
  mainImageXL= '',
  categorias = []
} = blog.data

const {
  data : {
    title : categoryTitle = '',
  },
  slug : categorySlug = ''
} = await getEntry('categorias', `${categorias[0]}`) || { data : { title : '' }, slug : '' }

const authorInfo = await getEntry('medicos', `${author}`)
const imageTemp = await loadImage(seoImage)

const seo = {
  title : title,
  description: seoDescription,
  image : imageTemp,
}
---
<BlogLayout
  {seo}
  images = {{
    mobile: seoImage,
    desktop: mainImageXL
  }}
  author = { authorInfo?.data }
  breadcrumbs={{
    title: `Volver a ${categoryTitle}`,
    url: `/blog/${categorySlug}`
  }}
>
  <Content/>
</BlogLayout>
